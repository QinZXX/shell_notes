## shell数学计算

如果要执行算术运算（数学计算），就离不开各种运算符号，和其他编程语言类似，Shell 也有很多算术运算符，下面介绍一下常见的 Shell 算术运算符，如下表所示。

| 算术运算符            | 说明/含义                                                |
| --------------------- | -------------------------------------------------------- |
| +、-                  | 加法（或正号）、减法（或负号）                           |
| *、/、%               | 乘法、除法、取余（取模）                                 |
| **                    | 幂运算                                                   |
| ++、--                | 自增和自减，可以放在变量的前面也可以放在变量的后面       |
| !、&&、\|\|           | 逻辑非（取反）、逻辑与（and）、逻辑或（or）              |
| <、<=、>、>=          | 比较符号（小于、小于等于、大于、大于等于）               |
| ==、!=、=             | 比较符号（相等、不相等；对于字符串，= 也可以表示相当于） |
| <<、>>                | 向左移位、向右移位                                       |
| ~、\|、 &、^          | 按位取反、按位或、按位与、按位异或                       |
| =、+=、-=、*=、/=、%= | 赋值运算符，例如 a+=1 相当于 a=a+1，a-=1 相当于 a=a-1    |

但是，Shell 和其它编程语言不同，Shell 不能直接进行算数运算，**必须使用数学计算命令**。

先来看一个反面的例子：

```bash
[]$ echo 2+8
2+8
[]$ a=23
[]$ b=$a+55
[]$ echo $b
23+55
[]$ b=90
[]$ c=$a+$b
[]$ echo $c
23+90
```

从上面的运算结果可以看出，默认情况下，Shell 不会直接进行算术运算，而是把`+`两边的数据（数值或者变量）**当做字符串**，**把`+`当做字符串连接符**，最终的结果是**把两个字符串拼接在一起形成一个新的字符串**。

这是因为，**在 Bash Shell 中，如果不特别指明，每一个变量的值都是字符串，无论你给变量赋值时有没有使用引号，值都会以字符串的形式存储**。

换句话说，Bash shell 在**默认情况下不会区分变量类型**，即使你将整数和小数赋值给变量，它们也会被视为字符串，这一点和大部分的编程语言不同。

## 数学计算命令

要想让数学计算发挥作用，必须使用数学计算命令，Shell 中常用的数学计算命令如下表所示。

| 运算操作符/运算命令 | 说明                                                         |
| ------------------- | ------------------------------------------------------------ |
| (( ))               | 用于整数运算，效率很高，**推荐使用**。                       |
| let                 | 用于整数运算，和 (()) 类似。                                 |
| $[]                 | 用于整数运算，不如 (()) 灵活。                               |
| expr                | 可用于整数运算，也可以处理字符串。比较麻烦，需要注意各种细节，不推荐使用。 |
| bc                  | Linux下的一个计算器程序，可以处理整数和小数。Shell 本身只支持整数运算，想计算小数就得使用 bc 这个外部的计算器。 |
| declare -i          | 将变量定义为整数，然后再进行数学运算时就不会被当做字符串了。功能有限，仅支持最基本的数学运算（加减乘除和取余），不支持逻辑运算、自增自减等，所以在实际开发中很少使用。 |

> 时间有限。。。只学习 (()) 和 bc ：(()) 可以用于整数计算，bc 可以小数计算。

## Shell (( )) 的用法

双小括号` (( )) `是 Bash Shell 中专门用来进行整数运算的命令，它的效率很高，写法灵活，是企业运维中常用的运算命令。

==注意：(( )) 只能进行整数运算，不能对小数（浮点数）或者字符串进行运算。后续讲到的 bc 命令可以用于小数运算。==

双小括号 (( )) 的语法格式为：

```bash
((表达式))
```

通俗地讲，就是将数学运算表达式放在`((`和`))`之间。

表达式可以只有一个，也可以有多个，多个表达式之间以逗号`,`分隔。**对于多个表达式的情况，以最后一个表达式的值作为整个 (( )) 命令的执行结果**。

可以使用`$`获取 `(( ))` 命令的结果，这和使用`$`获得变量值是类似的。



| 运算操作符/运算命令                  | 说明                                                         |
| ------------------------------------ | ------------------------------------------------------------ |
| ((a=10+66) ((b=a-15)) ((c=a+b))      | 这种写法可以在计算完成后给变量赋值。以 ((b=a-15)) 为例，即将 a-15 的运算结果赋值给变量 c。  注意，使用变量时不用加`$`前缀，(( )) 会自动解析变量名。 |
| `a=$((10+66) b=$((a-15)) c=$((a+b))` | 可以在 (( )) 前面加上`$`符号获取 (( )) 命令的执行结果，也即获取整个表达式的值。以 `c=$((a+b))` 为例，即将 a+b 这个表达式的运算结果赋值给变量 c。  注意，类似 c=((a+b)) 这样的写法是错误的，不加`$`就不能取得表达式的结果。 |
| ((a>7 && b==c))                      | (( )) 也可以进行逻辑运算，在 if 语句中常会使用逻辑运算。     |
| echo $((a+10))                       | 需要立即输出表达式的运算结果时，可以在 (( )) 前面加`$`符号。 |
| ((a=3+5, b=a+10))                    | 对多个表达式同时进行计算。                                   |


在 (( )) 中使用变量无需加上`$`前缀，(( )) 会自动解析变量名，这使得代码更加简洁，也符合程序员的书写习惯。

### Shell (( )) 实例演示

【实例1】利用 (( )) 进行简单的数值计算。

```bash
[]$ echo $((1+1))
2
[]$ echo $((6-3))
3
[]$ i=5
[]$ ((i=i*2))  #可以简写为 ((i*=2))。
[]$ echo $i   #使用 echo 输出变量结果时要加 $。
10
```


【实例2】用 (( )) 进行稍微复杂一些的综合算术运算。

```bash
[]$ ((a=1+2**3-4%3))
[]$ echo $a
8
[]$ b=$((1+2**3-4%3)) #运算后将结果赋值给变量，变量放在了括号的外面。
[]$ echo $b
8
[]$ echo $((1+2**3-4%3)) #也可以直接将表达式的结果输出，注意不要丢掉 $ 符号。
8
[]$ a=$((100*(100+1)/2)) #利用公式计算1+2+3+...+100的和。
[]$ echo $a
5050
[]$ echo $((100*(100+1)/2)) #也可以直接输出表达式的结果。
5050
```


【实例3】利用 (( )) 进行逻辑运算。

```bash
[]$ echo $((3<8))  #3<8 的结果是成立的，因此，输出了 1，1 表示真
1
[]$ echo $((8<3))  #8<3 的结果是不成立的，因此，输出了 0，0 表示假。
0
[]$ echo $((8==8)) #判断是否相等。
1
[]$ if ((8>7&&5==5))
> then
> echo yes
> fi
yes
```

最后是一个简单的 if 语句的格式，它的意思是，如果 8>7 成立，并且 5==5 成立，那么输出 yes。显然，这两个条件都是成立的，所以输出了 yes。

【实例4】利用 (( )) 进行自增（++）和自减（--）运算。

```bash
[]$ a=10
[]$ echo $((a++)) #如果++在a的后面，那么在输出整个表达式时，会输出a的值,因为a为10，所以表达式的值10。
10
[]$ echo $a #执行上面的表达式后，因为有a++，因此a会自增1，因此输出a的值为11。
11
[]$ a=11
[]$ echo $((a--)) #如果--在a的后面，那么在输出整个表达式时，会输出a的值，因为a为11，所以表达式的值为11。
11
[]$ echo $a #执行上面的表达式后，因为有a--，因此a会自动减1，因此a为10。
10
[]$ a=10
[]$ echo $((--a)) #如果--在a的前面，那么在输出整个表达式时，先进行自增或自减计算，所以表达式的值为9。
9
[]$ echo $a #执行上面的表达式后，a自减1,因此a为9。
9
[]$ echo $((++a))  #如果++在a的前面，输出整个表达式时，先进行自增或自减计算，所以输出10。
10
[]$ echo $a  #执行上面的表达式后，a自增1,因此a为10。
10
```


【实例5】利用 (( )) 同时对多个表达式进行计算。

```bash
[]$ ((a=3+5, b=a+10))  #先计算第一个表达式，再计算第二个表达式
[]$ echo $a $b
8 18
[]$ c=$((4+8, a+b))  #以最后一个表达式的结果作为整个(())命令的执行结果
[]$ echo $c
26
```

## $[]：对整数进行数学计算

和 (())、let 命令类似，$[] 也只能进行**整数运算**。

 `$[]` 的用法如下：

```bash
$[表达式]
```

`$`会对表达式进行计算，并取得计算结果。如果表达式中包含了变量，那么你可以加[] 会对`表达式`进行计算，并取得计算结果。如果`表达式`中包含了变量，那么你可以加`$`，也可以不加。

`$[]` 举例：

```bash
[]$ echo $[3*5]  #直接输出结算结果
15
[]$ echo $[(3+4)*5]  #使用()
35
[]$ n=6
[]$ m=$[n*2]  #将计算结果赋值给变量
[]$ echo $[m+n]
18
[]$ echo $[$m*$n]  #在变量前边加$也是可以的
72
[]$ echo $[4*(m+n)]
72
```


需要注意的是，**不能单独使用` $[]`，必须能够接收` $[] `的计算结果**。例如，下面的用法是错误的：

```bash
[]$ $[3+4]
bash: 7: 未找到命令...
[]$ $[m+3]
bash: 15: 未找到命令...
```

